machine:
  java:
    version: oraclejdk8
dependencies:
  pre:
    - curl -fL https://getcli.jfrog.io | sh
test:
  post:
    - mkdir -p $CIRCLE_ARTIFACTS/graphql-kotlin
    - mv target/site  $CIRCLE_ARTIFACTS/graphql-kotlin/coverage-report
    - cp target/graphql-kotlin-1.0-SNAPSHOT.jar target/graphql-kotlin-1.0.$CIRCLE_BUILD_NUM.jar
    - cp target/graphql-kotlin-1.0-SNAPSHOT-sources.jar target/graphql-kotlin-1.0.$CIRCLE_BUILD_NUM-sources.jar
    - bash <(curl -s https://codecov.io/bash)
    - ./jfrog bt config --user $ARTIFACTORY_USER --key $ARTIFACTORY_APIKEY --interactive false
    - ./jfrog bt upload target/graphql-kotlin-1.0.$CIRCLE_BUILD_NUM.jar $ARTIFACTORY_URL --publish true
    - ./jfrog bt upload target/graphql-kotlin-1.0.$CIRCLE_BUILD_NUM-sources.jar $ARTIFACTORY_URL --publish true